{
	"name": "s1-Testng 1",
	"properties": {
		"folder": {
			"name": "Testing"
		},
		"content": {
			"query": "CREATE TABLE #FactClaimDetails\n\t\t(\n\t\t\t[ClaimFormDetailId] [int] IDENTITY(1000000,1) ,\n\t\t\t--[ClaimFormDetailId] [int] IDENTITY(1000000,1) ,\n\t\t\t[ClaimFIRNo] [varchar](50) NULL,\n\t\t\t[ClaimType] [bit] NULL,\n\t\t\t[AmountBilled] [money] NULL,\n\t\t\t[AmountNet] [money] NULL,\n\t\t\t[AmountPaid] [money] NULL,\n\t\t\t[HospitalId] [int] NULL,\n\t\t\t[ClaimStatusId] [int] NULL,\n\t\t\t[DatePaid] [datetime] NULL,\n\t\t\t--[DateReceived] [datetime] NULL,\n\t\t\t[DateofAdmit] [datetime] NULL,\n\t\t\t[DateofDocumentation] [datetime] NULL,\n\t\t\t[DateofDischarge] [datetime] NULL,\n\t\t\t[DateModified] [datetime] NULL,\n\t\t\t[MemberDetailId] [int] NULL,\n\t\t\t[Diagnosis]\t[varchar](200) NULL, \n\t\t\t[Procedure]\t[varchar](200) NULL,\n\t\t\t[Corporate] [varchar](100) NULL\n\t\t\t \n\t\t)\t\t\n\n\t\tINSERT INTO #factclaimdetails\n\t\t(\n\t\t  [ClaimFIRNo] \n\t\t, [ClaimType] \n\t\t, [AmountBilled] \n\t\t, [AmountNet] \n\t\t, [AmountPaid] \t\n\t\t, [HospitalId] \n\t\t, [DatePaid] \n\t\t--, [DateReceived]\n\t\t, [DateofAdmit] \t\n\t\t, [DateofDocumentation] \n\t\t, [DateofDischarge] \n\t\t, [DateModified] \n\t\t, [MemberDetailId] \n\t\t, [Corporate] \n\t\t, [Diagnosis]\n\t\t, [Procedure]\n\t\t \n\t\t)\n\t\t\t\t\n\n\t\tSELECT\n\t\n\t\t\tET.BILL_NO\t\t\t\t\t\t\tClaimFIRNo \t\n\t\t,\tCASE \n\t\t\t\tWHEN ET.Claim_Type = 'Reimbursement' THEN 0 \n\t\t\t\tELSE 1 END\t\t\t\t\t\t \n\t\t,\tET.[Claimed Amount]\t\t\t\t\tAmountBilled\n\t\t,\tET.[Claimed Amount]\t\t\t\t\tAmountNet\n\t\t,\tET.[Transferred Amount]\t\t\t\tAmountPaid\n\t\t,\tH.HospitalId\t\t\t\t\t\tHospitalId\n\t\t,\tCONVERT(DATETIME,LEFT(ET.[Transferred Date],10))\t\t\t\tDatePaid\n\t\t--,\tCONVERT(DATETIME,LEFT(ET.[Transferred Date],10))\t\t\t\tDateReceived\n\t\t,\tCONVERT(DATETIME,LEFT(ET.[Loss_Date],10))\t\t\t\t\t\tDateofAdmin\n\t\t,\tCONVERT(DATETIME,LEFT(ET.[Date of last document received],10))\tDateofDocumentation\n\t\t,\tCONVERT(DATETIME,LEFT(ET.[Date of Discharge],10))\t\t\t\tDateofDischarge\n\t\t,\tCONVERT(DATETIME,LEFT(ET.[Date Modified],10))\t\t\t\t\tDateModified\n\t\t,\tMD.Member_Detail_id\t\t\t\t\tMemberDetailId\t\n\t\t,\tET.[Group name]\t\t\t\t\t\tCorporate\n\t\t,\tET.[Disease Description]\n\t\t,\tET.[Procedure Description]\n\t\t \n\t\n\t\tFROM load.EXTERNALTPADATA ET\n\t\tLEFT OUTER JOIN Factclaimdetails F ON ET.BILL_NO = F.ClaimFIRNo AND F.IsExternalTPAClaim = 1\n\t\tLEFT OUTER JOIN DimHospitalDetails H ON ET.[Provider Name] = H.HospitalName\n\t\tLEFT OUTER JOIN DimMembers M ON M.Member_code = ET.Member_ID AND M.[IsExternalTPA] = 1\n\t\tLEFT OUTER JOIN DimMemberDetails MD ON MD.member_Id = M.member_Id and MD.PolicyNo = ET.Policy_No AND MD.[IsExternalTPA] = 1\n\t\tWHERE\n\t\t\tF.Claimformdetailid IS NULL\n\n\t\tINSERT INTO factclaimdetails\n\t\t(\n\t\t  [ClaimFIRNo] \n\t\t, [ClaimType] \n\t\t, [AmountBilled] \n\t\t, [AmountNet] \n\t\t, [AmountPaid] \t\n\t\t, [HospitalId] \n\t\t, [DatePaid] \t\t \n\t\t, [DateofAdmit] \t\n\t\t, [DateofDocumentation] \n\t\t, [DateofDischarge] \n\t\t, [DateModified] \n\t\t, [MemberDetailId] \n\t\t, [Corporate] \n\t\t, [IsExternalTPAClaim]\n\t\t)\n\t\tSELECT \n\t\t \n\t\t  [ClaimFIRNo] \n\t\t, [ClaimType] \n\t\t, [AmountBilled] \n\t\t, [AmountNet] \n\t\t, [AmountPaid] \t\n\t\t, [HospitalId] \n\t\t, [DatePaid] \n\t  \n\t\t, [DateofAdmit] \t\n\t\t, [DateofDocumentation] \n\t\t, [DateofDischarge] \n\t\t, [DateModified] \n\t\t, [MemberDetailId] \n\t\t, [Corporate] \n\t\t, 1\n\t\t\n\t\tFROM #factclaimdetails\n\n\t\t\n\t\tINSERT INTO [dbo].[LnkClaimDiagnosisCodes]\n\t\t(\n\t\t\tIcdCodeId\n\t\t,\tClaimFormDetailId\n\t\t)\n\t\tSELECT \n\t\t\tD.IcdCodeId\n\t\t,\tF.ClaimFormDetailId\n\t\t \n\t\tFROM #FactClaimDetails F\n\t\tLEFT OUTER JOIN LnkClaimDiagnosisCodes L ON L.ClaimFormDetailId = F.ClaimformDetailId\n\t\tINNER JOIN dbo.DimDiagnosisCodes D ON D.IcdDescription = F.[Diagnosis]\n\t\tWHERE\n\t\t\tL.ClaimDiagnosisId IS NULL\n\n\n\t\tINSERT INTO [dbo].[LnkClaimProcedureDetails]\n\t\t(\n\t\t\tIcdCodeId\n\t\t,\tClaimFormDetailId\n\t\t)\n\t\tSELECT \n\t\t\tD.CptCodeId\n\t\t,\tF.ClaimFormDetailId\n\t\t  \n\t\tFROM #FactClaimDetails F\n\t\tLEFT OUTER JOIN LnkClaimProcedureDetails L ON L.ClaimFormDetailId = F.ClaimformDetailId\n\t\tINNER JOIN dbo.DimProcedureCodes D ON D.CptDescription = F.[Procedure]\n\t\tWHERE\n\t\t\tL.ClaimProcedureId IS NULL\n\t\t\n\t\tDROP TABLE #DimMembers\t\t\n\t\tDROP TABLE #DimMemberDetails\n\t\tDROP TABLE #factclaimdetails\n\t\t\t",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "ClaimsSummaryDSQL",
				"databaseName": "ClaimsSummaryDSQL"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}
